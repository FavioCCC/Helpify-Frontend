<button class="back-btn" [routerLink]="['/proyectos']" aria-label="Volver">←</button>

<h1 class="titulo">INFORMACIÓN DEL PROYECTO</h1>

<!-- MENSAJES -->
<div class="system-message-container">
  <div *ngIf="mensajeExito" class="system-message success-box">
    {{ mensajeExito }}
    <button (click)="limpiarMensajes()">×</button>
  </div>
  <div *ngIf="error" class="system-message error-box">
    {{ error }}
    <button (click)="limpiarMensajes()">×</button>
  </div>
</div>

<section class="proyecto-card" *ngIf="proyecto">

  <!-- Wishlist: Mostrar siempre si NO está logueado; si está logueado, sólo para VOLUNTARIO|DONANTE -->
  <button class="add-btn" (click)="marcarWishlist()" *ngIf="!isAuthenticated || (esVoluntario || esDonante)">
    Añadir ❤️
  </button>

  <div class="contenido">
    <div class="izquierda">
      <img class="imagen" [src]="proyecto.imagen" [alt]="proyecto.nombreproyecto" />

      <!-- Acciones de ADMIN (únicamente) -->
      <div class="acciones" *ngIf="esAdmin">
        <button class="btn btn-secondary" [routerLink]="['/proyectos', proyecto?.idproyecto, 'modificar']">
          Modificar
        </button>

        <button class="btn btn-secondary" (click)="eliminarProyecto()">
          Eliminar
        </button>
      </div>

      <!-- Modal de confirmación (solo si es admin y está en flujo de eliminar) -->
      <div *ngIf="esAdmin && mostrarConfirmacionEliminar" class="modal-overlay">
        <div class="modal-dialog">
          <p class="modal-pregunta">¿Estás seguro de eliminar este proyecto?</p>
          <div class="modal-botones">
            <button class="btn btn-confirmar" (click)="confirmarEliminacion()">Sí</button>
            <button class="btn btn-cancelar" (click)="cancelarEliminacion()">No</button>
          </div>
        </div>
      </div>
    </div>

    <div class="derecha">
      <h2 class="nombre">{{ proyecto.nombreproyecto }}</h2>
      <p class="descripcion">“{{ proyecto.descripcion }}”</p>

      <ul class="detalles">
        <li>• Monto objetivo: S/. {{ proyecto.montoobjetivo }}</li>
        <li>• Monto recaudado: S/. {{ proyecto.montorecaudado ?? 0 }}</li>
        <li>• Fecha inicio: {{ proyecto.fechainicio | date:'dd \'de\' MMMM \'de\' yyyy' }}</li>
        <li>• Fecha fin: {{ proyecto.fechafin | date:'dd \'de\' MMMM \'de\' yyyy' }}</li>
        <li>• Nombre de la Organización: {{ proyecto.nombreorganizacion || '—' }}</li>
        <li>• Escuela beneficiada: {{ proyecto.escuelabeneficiada || '—' }}</li>
        <li>• Cupo máximo: {{ proyecto.cupoMaximo ?? '—' }}</li>
        <li>• Cupo restante: {{ proyecto.cupoRestante ?? '—' }}</li>
      </ul>

      <div class="acciones-derecha">
        <!-- Si NO está autenticado: mostrar los 3 botones solicitados -->
        <div *ngIf="!isAuthenticated" class="acciones-no-logueado"  >
          <button class="btn inscribirme"
                  (click)="confirmarInscripcion()">
            Deseo inscribirme✍️️
          </button>

          <button class="btn contribuir"
                  [routerLink]="['/donar', proyecto?.idproyecto]">
            Deseo contribuir $
          </button>

        </div>

        <!-- Si está autenticado: comportamiento por roles como antes -->
        <ng-container *ngIf="isAuthenticated">
          <!-- Deseo inscribirme: SOLO voluntario -->
          <button class="btn inscribirme"
                  *ngIf="esVoluntario"
                  (click)="confirmarInscripcion()"
                  [disabled]="loading || yaInscrito || necesitaUniversitario"
                  [title]="yaInscrito ? 'Ya estás inscrita en este proyecto' : (necesitaUniversitario ? 'Completa tu registro de Universitario' : '')">
            {{
              yaInscrito
                ? 'Ya estás inscrita'
                : (necesitaUniversitario ? 'Debes registrarte como Universitario' : 'Deseo inscribirme✍️️')
            }}
          </button>

          <!-- Deseo contribuir: SOLO donante -->
          <button class="btn contribuir"
                  *ngIf="esDonante"
                  [routerLink]="['/donar', proyecto?.idproyecto]">
            Deseo contribuir $
          </button>
        </ng-container>
      </div>

      <!-- universitario solo aplica a voluntario -->
      <div class="hint" *ngIf="esVoluntario && necesitaUniversitario" style="margin-top:12px">
        Debes registrarte como <strong>Universitario</strong>.
        <a [routerLink]="['/crearperfil']">Completar registro</a>
      </div>
    </div>
  </div>
</section>
